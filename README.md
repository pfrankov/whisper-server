# WhisperServer

WhisperServer — это приложение для macOS, работающее в фоновом режиме только с иконкой в строке меню. Оно предоставляет HTTP-сервер, совместимый с OpenAI Whisper API, для транскрипции аудио.

## Основные возможности

- Работает как приложение для строки меню (без иконки в доке)
- Отображает иконку в строке меню с информацией о статусе
- Предоставляет API, совместимый с OpenAI Whisper API
- Поддерживает эндпоинт `/v1/audio/transcriptions` для транскрипции аудио
- HTTP-сервер на порту 8888
- Также возвращает "OK" в ответ на любой другой HTTP-запрос

## Как использовать

1. Соберите и запустите приложение в Xcode
2. Найдите иконку сервера в строке меню
3. HTTP-сервер автоматически запустится на порту 8888
4. Используйте API-эндпоинт для транскрипции: `http://localhost:8888/v1/audio/transcriptions`
5. Чтобы выйти из приложения, нажмите на иконку в строке меню и выберите "Quit"

## Пример использования Whisper API

Для транскрипции аудио:

```bash
curl -X POST http://localhost:8888/v1/audio/transcriptions \
  -F file=@/path/to/audio.mp3 \
  -F model=whisper-1 \
  -F response_format=json
```

Поддерживаемые параметры:
- `file` - файл аудио (обязательный)
- `model` - идентификатор модели (поддерживается только "whisper-1")
- `prompt` - текст для управления стилем транскрипции
- `response_format` - формат ответа (json, text, srt, vtt, verbose_json)
- `temperature` - температура сэмплирования от 0 до 1
- `language` - язык ввода (ISO-639-1)

## Форматы ответов

Сервер поддерживает следующие форматы ответов:

1. **json** (по умолчанию):
```json
{
  "text": "Текст транскрипции."
}
```

2. **verbose_json**:
```json
{
  "task": "transcribe",
  "language": "en",
  "duration": 10.5,
  "text": "Полный текст транскрипции.",
  "segments": [
    {
      "id": 0,
      "seek": 0,
      "start": 0.0,
      "end": 5.0,
      "text": "Первый сегмент.",
      "tokens": [50364, 13, 11, 263, 6116],
      "temperature": 0.0,
      "avg_logprob": -0.45,
      "compression_ratio": 1.275,
      "no_speech_prob": 0.1
    },
    // Другие сегменты...
  ]
}
```

3. **text**: Простой текстовый вывод

4. **srt**: Формат субтитров SubRip

5. **vtt**: Формат субтитров WebVTT

## Технические детали

- Приложение использует современный Network framework для создания HTTP-сервера
- Для порта по умолчанию используется значение 8888
- Не отображается окно — приложение работает полностью в фоновом режиме
- Оптимизированная архитектура кода для простоты поддержки

## Архитектура кода

Проект разделен на следующие основные компоненты:

- **WhisperServerApp.swift**: Точка входа в приложение SwiftUI и AppDelegate
- **SimpleHTTPServer.swift**: Реализация HTTP-сервера с поддержкой Whisper API
- **ContentView.swift**: Заполнитель SwiftUI, не отображается пользователю
- **Info.plist**: Конфигурация приложения и сетевые разрешения

## Требования

- macOS 11.0 или новее
- Xcode 13.0 или новее (для сборки)

## Устранение неполадок

Если у вас возникли проблемы с подключением к серверу:

1. Убедитесь, что приложение запущено (иконка в строке меню)
2. Проверьте, не блокирует ли брандмауэр порт 8888
3. Проверьте, нет ли других приложений, использующих порт 8888
4. Если сервер не отвечает, перезапустите приложение

Для подробных логов запустите приложение из Xcode и смотрите консоль. 